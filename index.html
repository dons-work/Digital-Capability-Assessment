<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Digital Capability Assessment — Enhanced</title>
    <style>
        :root{
            --bg: #1a1a2e;
            --card: #2e2e4a;
            --muted: #b0b0d0;
            --text: #e0e0e0;
            --accent: #90d4f2;
            --accent-2: #a44eef;
            --glass: rgba(255,255,255,0.03);
            --success: #7ed57e;
            --danger: #ff7b7b;
            --max-width: 980px;
            --radius: 12px;
            --gap: 18px;
        }

        /* ---------- Base ---------- */
        html,body{height:100%}
        body{
            margin:0;
            font-family: "Inter", "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(180deg, var(--bg) 0%, #0f1020 100%);
            color:var(--text);
            display:flex;
            justify-content:center;
            padding:28px;
            box-sizing:border-box;
        }
        a{color:var(--accent)}
        .page{
            width:100%;
            max-width:var(--max-width);
        }

        /* ---------- Header / Topbar ---------- */
        .dashboard-container{
            display:flex;
            align-items:center;
            justify-content:space-between;
            background: #0f0f1d;
            padding:12px 18px;
            border-radius: 10px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.5);
            margin-bottom:18px;
            border:1px solid rgba(255,255,255,0.03);
        }
        .logo-row{display:flex;align-items:center;gap:12px}
        .logo{height:44px;border-radius:8px}
        .dashboard-title{font-size:1.05rem;color:#d1d1d1;font-weight:700}
        .header-actions{display:flex;align-items:center;gap:8px}

        .hamburger-menu{
            background:var(--card);
            border:none;
            color:var(--accent);
            padding:8px 12px;
            border-radius:10px;
            cursor:pointer;
            font-size:1.15rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.35);
        }
        .hamburger-menu:focus{outline:3px solid rgba(144,212,242,0.14)}

        /* Dropdown Content (dark sleek theme) */
        .dropdown-content{
            position:absolute;
            right:18px;
            top:70px;
            min-width:300px;
            background:#10121b; /* darker charcoal */
            color:var(--text);
            border-radius:10px;
            padding:14px 16px;
            box-shadow: 0 14px 40px rgba(0,0,0,0.6);
            border:1px solid rgba(255,255,255,0.04);
            display:none;
            z-index:40;
            animation:fadeInDown .22s ease-out;
        }
        @keyframes fadeInDown{
            from{opacity:0; transform: translateY(-6px)}
            to{opacity:1; transform: translateY(0)}
        }
        .dropdown-content.show{display:block}
        .contact-name{font-weight:700;color:#fff;margin-bottom:6px;font-size:1rem}
        .contact-title{font-style:italic;color:var(--muted); margin-bottom:10px;border-bottom:1px solid rgba(255,255,255,0.03);padding-bottom:10px}

        .contact-row{display:flex;gap:10px;align-items:flex-start;margin-bottom:8px}
        .contact-row strong{display:inline-block;width:68px;color:var(--muted);font-weight:600}
        .contact-row a{color:var(--accent); text-decoration:none}
        .contact-row a:hover{text-decoration:underline}

        /* ---------- Card Container ---------- */
        .container{
            background:var(--card);
            border-radius:var(--radius);
            padding:28px;
            box-shadow: 0 18px 50px rgba(0,0,0,0.55);
            border:1px solid rgba(255,255,255,0.03);
            transition:transform .35s ease,opacity .35s ease;
        }

        header h1{
            margin:0;
            text-align:center;
            color:var(--accent);
            font-size:2rem;
            text-shadow: 1px 1px 6px rgba(0,0,0,0.5);
        }
        header p{color:var(--muted);text-align:center;margin-top:8px;margin-bottom:20px}

        /* ---------- Intro ---------- */
        #intro-section{ text-align:center }
        #intro-section p{ font-size:1.05rem;color:var(--muted);margin:0 0 22px}
        #start-button{
            background:linear-gradient(90deg,var(--accent),var(--accent-2));
            color:#081025;
            font-weight:700;
            padding:14px 28px;
            border:none;
            border-radius:12px;
            cursor:pointer;
            font-size:1.05rem;
            box-shadow: 0 12px 30px rgba(144,212,242,0.12);
        }
        #start-button:focus{outline:3px solid rgba(164,78,239,0.12)}

        /* ---------- Progress ---------- */
        .progress-wrap{display:flex;align-items:center;gap:12px;margin-bottom:18px}
        .progress-info{flex:1; font-size:0.95rem; color:var(--muted)}
        .progress-bar-container{flex-basis:100%;background:rgba(255,255,255,0.03);height:12px;border-radius:999px;overflow:hidden;border:1px solid rgba(255,255,255,0.02)}
        .progress-bar{
            height:100%;
            width:0%;
            background:linear-gradient(90deg,var(--accent),var(--accent-2));
            transition:width .45s cubic-bezier(.2,.8,.2,1);
            box-shadow:0 0 14px rgba(144,212,242,0.18);
        }
        .progress-percentage{width:70px;text-align:right;color:var(--muted); font-weight:600}

        /* ---------- Question Card ---------- */
        .question-card{
            background: linear-gradient(180deg, rgba(255,255,255,0.02), transparent);
            border-radius:10px;
            padding:20px;
            margin-bottom:16px;
            border:1px solid rgba(255,255,255,0.03);
            box-shadow: 0 8px 18px rgba(0,0,0,0.45);
            transition:transform .25s ease,box-shadow .25s ease;
        }
        .question-card:focus-within{transform:translateY(-4px);box-shadow:0 18px 40px rgba(0,0,0,0.6)}

        .question-card p{margin:0 0 14px;font-size:1.05rem;color:var(--text)}

        .options label{
            display:flex;
            align-items:center;
            gap:12px;
            padding:12px;
            border-radius:8px;
            margin-bottom:12px;
            cursor:pointer;
            background:var(--glass);
            border:1px solid rgba(255,255,255,0.02);
            transition:transform .15s ease,background .15s ease;
        }
        .options label:hover{transform:translateY(-3px); background: rgba(255,255,255,0.02)}
        .options input[type="radio"]{transform:scale(1.2);accent-color:var(--accent)}
        .options span{flex:1;color:var(--muted)}

        /* ---------- Navigation ---------- */
        .navigation-buttons{display:flex;gap:12px;margin-top:22px;justify-content:space-between}
        .btn{
            padding:12px 18px;border-radius:10px;border:none;cursor:pointer;font-weight:700;
            box-shadow:0 10px 24px rgba(0,0,0,0.35);
        }
        .btn-primary{background:linear-gradient(90deg,var(--accent),var(--accent-2)); color:#081025}
        .btn-secondary{background:#4a4a6e;color:var(--text)}
        .btn:disabled{opacity:0.5;cursor:not-allowed;box-shadow:none}

        /* ---------- Results ---------- */
        #results-dashboard{display:none}
        .score-display{
            width:180px;height:180px;border-radius:50%;
            background:linear-gradient(180deg,#3e3e5a,#2f2f4a);
            border:4px solid rgba(144,212,242,0.14);
            margin:18px auto;
            display:flex;align-items:center;justify-content:center;flex-direction:column;
            box-shadow:0 18px 40px rgba(144,212,242,0.06);
            transition:transform .25s ease;
        }
        .score-display:hover{transform:scale(1.06)}
        .score-value{font-size:2.8rem;font-weight:800;color:#fff}
        .score-label{font-size:.95rem;color:var(--muted)}

        .insights{margin-top:20px;padding:16px;border-radius:10px;background:linear-gradient(180deg, rgba(255,255,255,0.02), transparent);border:1px solid rgba(255,255,255,0.03)}
        .insights h3{color:var(--accent);margin:0 0 8px}
        .insights p{margin:0;color:var(--muted)}
        .recommendation-list{list-style:none;padding:0;margin-top:12px}
        .recommendation-list li{background:var(--glass);padding:12px;border-radius:8px;margin-bottom:10px;border-left:4px solid var(--accent-2);color:var(--text)}

        /* ---------- Category Breakdown Bars ---------- */
        .breakdown{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;margin-top:18px}
        .category-card{padding:12px;border-radius:10px;background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.02)}
        .category-card h4{margin:0 0 8px;color:var(--muted);font-size:0.95rem}
        .category-bar{height:12px;border-radius:999px;background:rgba(255,255,255,0.03);overflow:hidden;border:1px solid rgba(255,255,255,0.02)}
        .category-bar > i{display:block;height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent-2));transition:width .5s ease}

        /* ---------- Utilities ---------- */
        .meta-row{display:flex;gap:10px;align-items:center;justify-content:center;margin-top:14px;flex-wrap:wrap}
        .small-btn{padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.03);background:transparent;color:var(--muted);cursor:pointer}
        .muted{color:var(--muted)}
        .visually-hidden{position:absolute!important;height:1px;width:1px;overflow:hidden;clip:rect(1px,1px,1px,1px);white-space:nowrap;border:0;padding:0;margin:-1px}

        /* ---------- Responsive ---------- */
        @media (max-width:720px){
            header h1{font-size:1.5rem}
            .score-display{width:140px;height:140px}
            .navigation-buttons{flex-direction:column}
            .progress-percentage{display:none}
            .dropdown-content{right:12px;left:12px;top:68px;min-width:auto}
        }
    </style>
</head>
<body>
    <div class="page">
        <div class="dashboard-container" role="banner" aria-hidden="false">
            <div class="logo-row">
                <img class="logo" src="https://images2.imgbox.com/27/97/5G9XyuIr_o.png" alt="DS Logo">
                <div>
                    <div class="dashboard-title">Digital Capability Assessment</div>
                    <div class="muted" style="font-size:0.85rem;margin-top:4px">Measuring organisational readiness for digital transformation</div>
                </div>
            </div>

            <div class="header-actions" aria-hidden="false">
                <div style="position:relative">
                    <button id="hamburger-button" class="hamburger-menu" aria-haspopup="true" aria-expanded="false" aria-controls="dropdown-menu" aria-label="Open contact menu">☰</button>
                    <div id="dropdown-menu" class="dropdown-content" role="menu" aria-hidden="true" tabindex="-1">
                        <div class="contact-name">Don Spampinato</div>
                        <div class="contact-title">Digital Transformation Solutions Consultant</div>

                        <div class="contact-row"><strong>Email:</strong><a href="mailto:donspampinato@gmail.com" role="menuitem">donspampinato@gmail.com</a></div>
                        <div class="contact-row"><strong>Phone:</strong><a href="tel:+447983352068" role="menuitem">+44 (0) 7983 352 068</a></div>
                        <div class="contact-row"><strong>Website:</strong><a href="http://www.donspampinato.co.uk" role="menuitem" target="_blank" rel="noopener noreferrer">www.donspampinato.co.uk</a></div>
                        <div class="contact-row"><strong>LinkedIn:</strong><a href="https://www.linkedin.com/in/donspampinato/" role="menuitem" target="_blank" rel="noopener noreferrer">in/donspampinato</a></div>
                        <div class="contact-row"><strong>Portfolio:</strong><a href="https://bit.ly/40IR7zh" role="menuitem" target="_blank" rel="noopener noreferrer">bit.ly/40IR7zh</a></div>
                    </div>
                </div>
            </div>
        </div>

        <main class="container" role="main" aria-labelledby="main-title">
            <header>
                <h1 id="main-title">Digital Capability Assessment</h1>
                <p>Evaluate your enterprise's digital maturity across key strategic areas, including technology, data, processes, and talent.</p>
                <p>By answering a series of targeted questions, you’ll receive a personalised assessment that highlights strengths, uncovers gaps, and identifies opportunities for improvement. The outcome is a tailored score and actionable recommendations designed to guide your organisation’s digital transformation journey, optimise performance, and ensure alignment with future business goals.</p>
            </header>

            <!-- Intro -->
            <section id="intro-section" aria-live="polite">
                <p>Welcome — this short assessment takes less than 5 minutes. Your answers are saved locally so you can resume later if needed.</p>
                <div style="display:flex;gap:10px;justify-content:center;align-items:center">
                    <button id="start-button">Start Assessment</button>
                    <button id="resume-button" class="small-btn" style="display:none">Resume Saved Assessment</button>
                </div>
                <div class="meta-row" style="margin-top:14px">
                    <button id="examplesBtn" class="small-btn" title="See sample use cases">Use cases</button>
                    <button id="exportCsvBtn" class="small-btn" title="Export results (CSV)" style="display:none">Export CSV</button>
                    <button id="printBtn" class="small-btn" title="Print / Save as PDF" style="display:none">Print / PDF</button>
                </div>
            </section>

            <!-- Assessment Section -->
            <section id="assessment-section" aria-hidden="true" style="display:none">
                <div class="progress-wrap" role="region" aria-label="Progress">
                    <div class="progress-info" id="progressInfo" aria-live="polite">Question <strong id="qIndex">1</strong> of <span id="qTotal">0</span></div>
                    <div class="progress-bar-container" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="Assessment progress">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="progress-percentage" id="progressPercentage">0%</div>
                </div>

                <div id="questions-container" tabindex="0">
                    <!-- Questions injected here -->
                </div>

                <div class="navigation-buttons" style="margin-top:18px">
                    <button id="prevButton" class="btn btn-secondary" disabled aria-disabled="true">Previous</button>
                    <div style="display:flex;gap:12px">
                        <button id="saveExitBtn" class="small-btn" title="Save and exit">Save & exit</button>
                        <button id="nextButton" class="btn btn-primary">Next</button>
                    </div>
                </div>
            </section>

            <!-- Results -->
            <section id="results-dashboard" aria-hidden="true" style="display:none">
                <h2 style="text-align:center;color:var(--accent)">Your Digital Capability Score</h2>

                <div class="score-display" aria-hidden="false">
                    <div id="finalScore" class="score-value" aria-live="polite">0</div>
                    <div class="score-label">out of 100</div>
                </div>

                <div class="insights" role="region" aria-label="Insights">
                    <h3>Personalized insights & recommendations</h3>
                    <p id="insightMessage" class="muted" style="margin-bottom:10px"></p>
                    <ul id="recommendations" class="recommendation-list"></ul>
                </div>

                <div class="breakdown" id="categoryBreakdown" aria-hidden="false">
                    <!-- category cards -->
                </div>

                <div class="meta-row" style="margin-top:18px;justify-content:center">
                    <button id="restartButton" class="btn btn-secondary">Retake Assessment</button>
                    <button id="exportCsvResults" class="small-btn" title="Export CSV">Export CSV</button>
                    <button id="printResults" class="small-btn" title="Print results">Print / PDF</button>
                </div>
            </section>
        </main>
         <footer class="dashboard-footer">
             <div class="muted" style="font-size:0.75rem;margin-top:4px">Don Spampinato Digital Capability Assessment Demo © 2025. Content is simulated.</div>
        </footer>
    </div>

    <script>
    /***** Data & Config *****/
    const STORAGE_KEY = 'dca_user_answers_v1';
    const QUESTIONS = [
        {
            question: "How well does your organization integrate digital technologies into its core business processes?",
            options: [
                { text: "Minimal integration, mostly manual processes.", score: 1 },
                { text: "Some digital tools, but silos exist and integration is ad-hoc.", score: 2 },
                { text: "Significant digital tool adoption with moderate integration across departments.", score: 3 },
                { text: "Highly integrated digital processes, leveraging automation and data flow.", score: 4 }
            ],
            category: "Digital Integration"
        },
        {
            question: "To what extent does your leadership team champion and invest in digital transformation initiatives?",
            options: [
                { text: "Limited awareness or interest from leadership.", score: 1 },
                { text: "Supportive in principle, but investment is inconsistent.", score: 2 },
                { text: "Actively supports and allocates resources to digital initiatives.", score: 3 },
                { text: "Digital transformation is a top strategic priority with strong leadership commitment and funding.", score: 4 }
            ],
            category: "Leadership & Strategy"
        },
        {
            question: "How mature is your organization's use of data analytics for decision-making?",
            options: [
                { text: "Decisions are primarily gut-feeling or based on limited historical reports.", score: 1 },
                { text: "Basic descriptive analytics (what happened) are used.", score: 2 },
                { text: "Some predictive analytics (what might happen) are employed.", score: 3 },
                { text: "Advanced prescriptive analytics (what should we do) are embedded in decision-making processes.", score: 4 }
            ],
            category: "Data & Analytics"
        },
        {
            question: "Describe your organization's approach to customer experience (CX) design in the digital realm.",
            options: [
                { text: "CX is an afterthought, mostly reactive to issues.", score: 1 },
                { text: "Basic digital touchpoints exist, but are not always seamless.", score: 2 },
                { text: "Proactive CX design for key digital journeys, with regular feedback loops.", score: 3 },
                { text: "Customer-centric design is at the core of all digital initiatives, with continuous innovation and personalization.", score: 4 }
            ],
            category: "Customer Experience"
        },
        {
            question: "How agile and adaptive are your organizational structures and processes to market changes and digital disruption?",
            options: [
                { text: "Rigid, hierarchical structures slow to adapt.", score: 1 },
                { text: "Some pockets of agility, but enterprise-wide adoption is limited.", score: 2 },
                { text: "Adopting agile methodologies in many areas, encouraging cross-functional collaboration.", score: 3 },
                { text: "Highly agile, adaptable organization with continuous learning and rapid iteration built into its DNA.", score: 4 }
            ],
            category: "Agility & Culture"
        },
        {
            question: "What is the state of your organization's digital skills and talent development?",
            options: [
                { text: "Significant skill gaps, limited training or recruitment for digital roles.", score: 1 },
                { text: "Ad-hoc training programs, some external hires for specific digital needs.", score: 2 },
                { text: "Structured internal training, upskilling programs, and targeted digital talent acquisition.", score: 3 },
                { text: "A robust digital talent strategy, continuous learning culture, and strong retention of digital experts.", score: 4 }
            ],
            category: "Digital Talent"
        },
        {
            question: "How robust is your organization's cybersecurity framework and data privacy compliance?",
            options: [
                { text: "Basic security measures, compliance is often reactive.", score: 1 },
                { text: "Standard security protocols in place, working towards compliance.", score: 2 },
                { text: "Comprehensive cybersecurity framework, proactive threat detection, and strong compliance adherence.", score: 3 },
                { text: "Advanced, AI-driven cybersecurity defenses, fully compliant, and a culture of security awareness.", score: 4 }
            ],
            category: "Cybersecurity & Governance"
        },
        {
            question: "To what extent does your organization foster innovation and experimentation with emerging technologies?",
            options: [
                { text: "Rarely experiments, innovation is risk-averse.", score: 1 },
                { text: "Occasional pilot projects, but limited scaling.", score: 2 },
                { text: "Dedicated innovation hubs or teams, with a structured approach to experimentation.", score: 3 },
                { text: "A culture of continuous innovation, leveraging emerging tech (AI, Blockchain, IoT) to create new value streams.", score: 4 }
            ],
            category: "Innovation & Technology"
        }
    ];

    const MAX_SCORE_PER_Q = 4;
    const QUESTIONS_COUNT = QUESTIONS.length;
    const MAX_POSSIBLE = QUESTIONS_COUNT * MAX_SCORE_PER_Q;

    /***** State *****/
    let currentQuestionIndex = 0;
    let userAnswers = new Array(QUESTIONS_COUNT).fill(0); // values 0..4

    /***** DOM refs *****/
    const introSection = document.getElementById('intro-section');
    const startButton = document.getElementById('start-button');
    const resumeButton = document.getElementById('resume-button');
    const assessmentSection = document.getElementById('assessment-section');
    const questionsContainer = document.getElementById('questions-container');
    const prevButton = document.getElementById('prevButton');
    const nextButton = document.getElementById('nextButton');
    const saveExitBtn = document.getElementById('saveExitBtn');
    const progressBar = document.getElementById('progressBar');
    const qIndexElem = document.getElementById('qIndex');
    const qTotalElem = document.getElementById('qTotal');
    const progressPercentage = document.getElementById('progressPercentage');

    const resultsDashboard = document.getElementById('results-dashboard');
    const finalScoreDisplay = document.getElementById('finalScore');
    const insightMessage = document.getElementById('insightMessage');
    const recommendationsList = document.getElementById('recommendations');
    const categoryBreakdown = document.getElementById('categoryBreakdown');
    const restartButton = document.getElementById('restartButton');
    const exportCsvResultsBtn = document.getElementById('exportCsvResults');
    const printResults = document.getElementById('printResults');

    const exportCsvBtn = document.getElementById('exportCsvBtn');
    const printBtn = document.getElementById('printBtn');
    const examplesBtn = document.getElementById('examplesBtn');

    const hamburgerButton = document.getElementById('hamburger-button');
    const dropdownMenu = document.getElementById('dropdown-menu');

    /***** Init UI *****/
    document.addEventListener('DOMContentLoaded', () => {
        qTotalElem.textContent = QUESTIONS_COUNT;
        checkSavedState();
        bindUI();
    });

    function bindUI(){
        startButton.addEventListener('click', startAssessment);
        resumeButton.addEventListener('click', resumeAssessment);
        nextButton.addEventListener('click', onNextClicked);
        prevButton.addEventListener('click', showPreviousQuestion);
        saveExitBtn.addEventListener('click', saveAndExit);
        restartButton.addEventListener('click', restartAssessment);
        exportCsvResultsBtn.addEventListener('click', exportCsvResults);
        printResults.addEventListener('click', () => window.print());
        exportCsvBtn.addEventListener('click', exportCsvResults);
        printBtn.addEventListener('click', () => window.print());
        examplesBtn.addEventListener('click', showUseCases);

        hamburgerButton.addEventListener('click', toggleDropdownMenu);
        window.addEventListener('click', (e) => {
            if (!dropdownMenu.contains(e.target) && !hamburgerButton.contains(e.target)) {
                dropdownMenu.classList.remove('show');
                hamburgerButton.setAttribute('aria-expanded','false');
                dropdownMenu.setAttribute('aria-hidden','true');
            }
        });
    }

    /***** Resume / Save State Logic *****/
    function checkSavedState(){
        const saved = localStorage.getItem(STORAGE_KEY);
        if(saved){
            resumeButton.style.display = 'inline-block';
            exportCsvBtn.style.display = 'inline-block';
            printBtn.style.display = 'inline-block';
        } else {
            resumeButton.style.display = 'none';
        }
    }

    function saveState(){
        const payload = {
            answers: userAnswers,
            currentQuestionIndex,
            timestamp: new Date().toISOString()
        };
        localStorage.setItem(STORAGE_KEY, JSON.stringify(payload));
        checkSavedState();
    }

    function clearSavedState(){
        localStorage.removeItem(STORAGE_KEY);
        checkSavedState();
    }

    function loadState(){
        try{
            const saved = JSON.parse(localStorage.getItem(STORAGE_KEY));
            if(saved && Array.isArray(saved.answers) && saved.answers.length === QUESTIONS_COUNT){
                userAnswers = saved.answers;
                currentQuestionIndex = typeof saved.currentQuestionIndex === 'number' ? saved.currentQuestionIndex : 0;
                return true;
            }
        }catch(e){
            console.warn('Could not load saved state', e);
        }
        return false;
    }

    /***** Flow Handlers *****/
    function startAssessment(){
        userAnswers = new Array(QUESTIONS_COUNT).fill(0);
        currentQuestionIndex = 0;
        introSection.style.display = 'none';
        assessmentSection.style.display = 'block';
        resultsDashboard.style.display = 'none';
        renderQuestion();
        updateProgressUI();
        setTimeout(()=>questionsContainer.focus(),200);
    }

    function resumeAssessment(){
        const ok = loadState();
        if(!ok){
            alert('No saved assessment found or saved data is corrupt; starting new assessment.');
            startAssessment();
            return;
        }
        introSection.style.display = 'none';
        assessmentSection.style.display = 'block';
        resultsDashboard.style.display = 'none';
        renderQuestion();
        updateProgressUI();
        setTimeout(()=>questionsContainer.focus(),200);
    }

    function saveAndExit(){
        saveState();
        assessmentSection.style.display = 'none';
        introSection.style.display = 'block';
        alert('Your answers are saved locally; you can resume later.');
    }

    function restartAssessment(){
        if(confirm('Are you sure you want to retake the assessment? This will clear saved answers.')){
            userAnswers = new Array(QUESTIONS_COUNT).fill(0);
            currentQuestionIndex = 0;
            clearSavedState();
            resultsDashboard.style.display = 'none';
            introSection.style.display = 'block';
            assessmentSection.style.display = 'none';
            progressBar.style.width = '0%';
            progressPercentage.textContent = '0%';
        }
    }

    /***** Question Rendering & Interaction *****/
    function renderQuestion(){
        const q = QUESTIONS[currentQuestionIndex];
        qIndexElem.textContent = currentQuestionIndex + 1;

        questionsContainer.innerHTML = '';
        const card = document.createElement('div');
        card.className = 'question-card';
        card.setAttribute('tabindex','-1');

        const qText = document.createElement('p');
        qText.innerText = `Question ${currentQuestionIndex + 1} of ${QUESTIONS_COUNT}: ${q.question}`;
        card.appendChild(qText);

        const opts = document.createElement('div');
        opts.className = 'options';
        q.options.forEach((opt, idx) => {
            const id = `q${currentQuestionIndex}_opt${idx}`;
            const label = document.createElement('label');
            label.setAttribute('for', id);
            label.tabIndex = 0;
            label.addEventListener('keydown', (ev) => {
                if(ev.key === 'Enter' || ev.key === ' '){
                    ev.preventDefault();
                    const inputEl = label.querySelector('input');
                    if(inputEl) inputEl.checked = true;
                    onOptionSelected(idx+1);
                }
            });

            const input = document.createElement('input');
            input.type = 'radio';
            input.name = `question${currentQuestionIndex}`;
            input.id = id;
            input.value = opt.score;
            input.checked = userAnswers[currentQuestionIndex] === opt.score;
            input.addEventListener('change', () => onOptionSelected(opt.score));
            input.addEventListener('keydown', (ev) => {
                if(ev.key === 'ArrowDown' || ev.key === 'ArrowRight'){
                    ev.preventDefault();
                    const next = label.nextElementSibling;
                    if(next) next.focus();
                } else if(ev.key === 'ArrowUp' || ev.key === 'ArrowLeft'){
                    ev.preventDefault();
                    const prev = label.previousElementSibling;
                    if(prev) prev.focus();
                }
            });

            const span = document.createElement('span');
            span.innerText = opt.text;

            label.appendChild(input);
            label.appendChild(span);
            opts.appendChild(label);
        });
        card.appendChild(opts);

        questionsContainer.appendChild(card);

        updateNavigationButtons();
    }

    function onOptionSelected(score){
        userAnswers[currentQuestionIndex] = Number(score);
        updateNavigationButtons();
        updateProgressUI();
        saveState();
    }

    function updateNavigationButtons(){
        prevButton.disabled = currentQuestionIndex === 0;
        prevButton.setAttribute('aria-disabled', prevButton.disabled);
        nextButton.textContent = currentQuestionIndex === QUESTIONS_COUNT - 1 ? 'Submit' : 'Next';

        const hasAnswer = userAnswers[currentQuestionIndex] !== 0;
        nextButton.disabled = !hasAnswer;
    }

    function onNextClicked(){
        if(userAnswers[currentQuestionIndex] === 0){
            alert('Please select an answer before proceeding.');
            return;
        }
        if(currentQuestionIndex < QUESTIONS_COUNT - 1){
            currentQuestionIndex++;
            renderQuestion();
            updateProgressUI();
            setTimeout(()=>questionsContainer.focus(),100);
        } else {
            calculateResults();
        }
    }

    function showPreviousQuestion(){
        if(currentQuestionIndex > 0){
            currentQuestionIndex--;
            renderQuestion();
            updateProgressUI();
        }
    }

    /***** Progress UI *****/
    function updateProgressUI(){
        const answeredCount = userAnswers.filter(v=>v!==0).length;
        const percent = Math.round((answeredCount / QUESTIONS_COUNT) * 100);
        progressBar.style.width = percent + '%';
        progressBar.parentElement.setAttribute('aria-valuenow', percent);
        progressPercentage.textContent = `${percent}%`;
        qIndexElem.textContent = currentQuestionIndex + 1;
        if(answeredCount > 0){
            exportCsvBtn.style.display = 'inline-block';
            printBtn.style.display = 'inline-block';
        }
    }

    /***** Results & Insights *****/
    function calculateResults(){
        assessmentSection.style.display = 'none';
        resultsDashboard.style.display = 'block';

        const totalScore = userAnswers.reduce((s,v)=>s+v,0);
        const percentageScore = Math.round((totalScore / MAX_POSSIBLE) * 100);
        finalScoreDisplay.textContent = percentageScore;

        const insights = generateTopLevelInsights(percentageScore);
        insightMessage.textContent = insights.message;
        recommendationsList.innerHTML = '';
        insights.recommendations.forEach(r => {
            const li = document.createElement('li');
            li.innerText = r;
            recommendationsList.appendChild(li);
        });

        const categoryScores = computeCategoryScores();
        renderCategoryBreakdown(categoryScores);

        exportCsvResultsBtn.style.display = 'inline-block';
        printResults.style.display = 'inline-block';
        exportCsvBtn.style.display = 'inline-block';
        printBtn.style.display = 'inline-block';
    }

    function generateTopLevelInsights(score){
        const recs = [];
        let message = '';
        if(score >= 80){
            message = "Excellent; your organisation demonstrates strong digital capability. Continue to invest in experimentation to preserve advantage.";
            recs.push("Pilot advanced AI and ML projects that deliver measurable ROI.");
            recs.push("Invest in continuous learning programmes and cross-functional rotations.");
            recs.push("Operationalise innovation by allocating small venture funding for internal pilots.");
        } else if(score >= 60){
            message = "Good; you have solid foundations. A focused push on data and leadership alignment will accelerate impact.";
            recs.push("Prioritise a data-governance and analytics roadmap to close insight gaps.");
            recs.push("Align transformation initiatives to measurable business KPIs.");
            recs.push("Upskill key teams in cloud, data engineering and product thinking.");
        } else if(score >= 40){
            message = "Moderate; your organisation is on its digital journey but needs clear strategy and capability investment.";
            recs.push("Develop a strategic digital roadmap with owned KPIs and quick-wins.");
            recs.push("Address capability gaps through targeted hiring and tailored training.");
            recs.push("Start small, measure impact, then scale successful pilots.");
        } else {
            message = "Needs improvement; foundational investments in leadership, infrastructure and skills are essential to remain competitive.";
            recs.push("Secure executive sponsorship and a formal digital transformation charter.");
            recs.push("Invest in essential infrastructure: cloud, security and basic analytics.");
            recs.push("Create simple, measurable pilot projects to build momentum and literacy.");
        }
        return { message, recommendations: recs };
    }

    function computeCategoryScores(){
        const byCategory = {};
        QUESTIONS.forEach((q, idx) => {
            const cat = q.category || 'Other';
            if(!byCategory[cat]) byCategory[cat] = { total:0, count:0 };
            byCategory[cat].total += userAnswers[idx] || 0;
            byCategory[cat].count += 1;
        });
        const result = [];
        for(const cat in byCategory){
            const c = byCategory[cat];
            const percent = Math.round((c.total / (c.count * MAX_SCORE_PER_Q)) * 100);
            result.push({ category: cat, percent });
        }
        return result;
    }

    function renderCategoryBreakdown(categoryScores){
        categoryBreakdown.innerHTML = '';
        categoryScores.forEach(cs => {
            const card = document.createElement('div');
            card.className = 'category-card';
            const title = document.createElement('h4');
            title.innerText = `${cs.category} — ${cs.percent}%`;
            const barWrap = document.createElement('div');
            barWrap.className = 'category-bar';
            const bar = document.createElement('i');
            bar.style.width = '0%';
            setTimeout(()=>{ bar.style.width = cs.percent + '%'; }, 120);
            barWrap.appendChild(bar);
            card.appendChild(title);
            card.appendChild(barWrap);
            const smallRec = document.createElement('div');
            smallRec.style.marginTop='8px';
            smallRec.style.fontSize='0.9rem';
            smallRec.style.color='var(--muted)';
            smallRec.innerText = shortRecommendationForCategory(cs.category, cs.percent);
            card.appendChild(smallRec);
            categoryBreakdown.appendChild(card);
        });
    }

    function shortRecommendationForCategory(category, percent){
        if(percent >= 80) return 'Strength: keep investing and scaling.';
        if(percent >= 60) return 'Opportunity: focus investment to move from good to great.';
        if(percent >= 40) return 'Action: define a roadmap and quick wins.';
        return 'Foundation: leadership, capability and infrastructure required.';
    }

    /***** CSV Export *****/
    // Contact info as requested
    const CONTACT_INFO = {
        name: '© 2025 Don Spampinato. All rights reserved. This export is provided for informational purposes only and may not be shared or copied without prior written consent.',

    };

    function buildResultPayload(){
        const totalScore = userAnswers.reduce((s,v)=>s+v,0);
        const percentageScore = Math.round((totalScore / MAX_POSSIBLE) * 100);
        const categories = computeCategoryScores();
        return {
            timestamp: new Date().toISOString(),
            contact: CONTACT_INFO,
            questionsCount: QUESTIONS_COUNT,
            answers: userAnswers,
            totalScore,
            percentageScore,
            categories
        };
    }

    function exportCsvResults(){
        const payload = buildResultPayload();

        // Flatten categories into "Category:percent" semicolon list
        const categoriesFlat = payload.categories.map(c => `${c.category}:${c.percent}%`).join('; ');

        // Flatten answers as CSV-friendly string
        const answersFlat = payload.answers.join(';');

        // Build a simple two-row CSV with headers and values for readability
        const headers = [
            'Timestamp','Copyright','QuestionsCount','Answers','TotalScore','PercentageScore','Categories','Recommendations'
        ];

        const recommendations = (document.querySelectorAll('#recommendations li') && document.querySelectorAll('#recommendations li').length > 0)
            ? Array.from(document.querySelectorAll('#recommendations li')).map(li => li.textContent).join(' | ')
            : '';

        const values = [
            payload.timestamp,
            payload.contact.name,
            payload.contact.title,
            payload.contact.email,
            payload.contact.phone,
            payload.contact.website,
            payload.contact.linkedin,
            payload.contact.portfolio,
            payload.questionsCount,
            `"${answersFlat}"`,
            payload.totalScore,
            payload.percentageScore,
            `"${categoriesFlat}"`,
            `"${recommendations}"`
        ];

        const csvContent = `${headers.join(',')}\n${values.join(',')}\n`;

        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        const dateStamp = new Date().toISOString().slice(0,19).replace(/:/g,'-');
        a.download = `digital-capability-results-${dateStamp}.csv`;
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
    }

    /***** Small utilities / extras *****/
    function toggleDropdownMenu(){
        const visible = dropdownMenu.classList.toggle('show');
        hamburgerButton.setAttribute('aria-expanded', visible ? 'true' : 'false');
        dropdownMenu.setAttribute('aria-hidden', visible ? 'false' : 'true');
        if(visible) dropdownMenu.focus();
    }

    function showUseCases(){
        alert('Use cases:\n\n• Quick self-assessment for leadership workshops; • Department-level assessments to compare maturity; • Baseline for digital strategy planning.');
    }

    // Small alert to inform user about local save; only show once
    (function showAlertOnce(){
        const k = 'dca_alert_resume_hint_v1';
        if(!localStorage.getItem(k)){
            localStorage.setItem(k,'1');
            // non-intrusive hint (not alert blocking)
            console.info('Tip: This demo saves answers locally to your browser; clear storage to fully reset.');
        }
    })();

    </script>
</body>
</html>
